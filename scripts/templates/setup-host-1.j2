#!/bin/bash
# Setup script for {{ display_name }} lab

set -e

echo "[Workshop] Setting up {{ display_name }} lab environment..."

# Install Python dependencies if needed
if ! command -v python3 &> /dev/null; then
  echo "[Workshop] Installing Python..."
  apt-get update && apt-get install -y python3 python3-pip
fi

# Install backend dependencies
if [ -f "/opt/workshop-assets/backend/requirements.txt" ]; then
  echo "[Workshop] Installing backend dependencies..."
  pip3 install -r /opt/workshop-assets/backend/requirements.txt
fi

# Start backend server
echo "[Workshop] Starting backend server..."
cd /opt/workshop-assets/backend
python3 -m uvicorn main:app --host 0.0.0.0 --port 8000 &
BACKEND_PID=$!
echo $BACKEND_PID > /tmp/backend.pid

# Wait for backend to be ready
echo "[Workshop] Waiting for backend to start..."
for i in {1..30}; do
  if curl -s http://localhost:8000/health > /dev/null 2>&1; then
    echo "[Workshop] ✓ Backend is ready"
    break
  fi
  sleep 1
done

echo "[Workshop] ✓ Setup complete"

